<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Teste Procedures - Usuário / JSON / Mongo</title>
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
</head>
<body class="bg-light">

<nav class="navbar navbar-dark bg-dark mb-4">
    <div class="container">
        <span class="navbar-brand mb-0 h1">ReStartAI - Teste Procedures</span>
    </div>
</nav>

<div class="container">

    <!-- Mensagens de sucesso/erro de usuários -->
    <div th:if="${mensagemSucesso}" class="alert alert-success">
        <span th:text="${mensagemSucesso}"></span>
    </div>

    <!-- Mensagens de export JSON -->
    <div th:if="${mensagemJsonSucesso}" class="alert alert-success">
        <span th:text="${mensagemJsonSucesso}"></span>
    </div>
    <div th:if="${mensagemJsonErro}" class="alert alert-danger">
        <span th:text="${mensagemJsonErro}"></span>
    </div>

    <!-- Mensagens de import Mongo -->
    <div th:if="${mensagemMongoSucesso}" class="alert alert-success">
        <span th:text="${mensagemMongoSucesso}"></span>
    </div>
    <div th:if="${mensagemMongoErro}" class="alert alert-danger">
        <span th:text="${mensagemMongoErro}"></span>
    </div>

    <!-- Card: criação de usuários via procedure -->
    <div class="card shadow-sm mb-4">
        <div class="card-header">
            <h5 class="mb-0">Criar usuários de teste via procedure</h5>
        </div>
        <div class="card-body">

            <p class="mb-3">
                Cada botão abaixo chama, pelo backend, a procedure
                <strong>PKG_RESTART_CORE.PRC_INSERIR_USUARIO</strong> no Oracle,
                inserindo um usuário diferente na tabela <strong>USUARIO</strong>.
            </p>

            <!-- Botão 1: Ana Beatriz -->
            <form th:action="@{/procedures/usuarios/teste}" method="post" class="mb-3">
                <button type="submit" class="btn btn-primary w-100">
                    Criar usuária de teste: Ana Beatriz Souza
                    (<small>ana.beatriz@restart.com</small>)
                </button>
            </form>

            <!-- Botão 2: Carlos Eduardo -->
            <form th:action="@{/procedures/usuarios/teste2}" method="post">
                <button type="submit" class="btn btn-secondary w-100">
                    Criar usuário de teste: Carlos Eduardo Lima
                    (<small>carlos.eduardo@restart.com</small>)
                </button>
            </form>

        </div>
    </div>

    <!-- Card: exportação de currículos para JSON via procedure + import para Mongo -->
    <div class="card shadow-sm mb-4">
        <div class="card-header">
            <h5 class="mb-0">Exportar JSON (Oracle) e importar no MongoDB</h5>
        </div>
        <div class="card-body">

            <p class="mb-3">
                O botão abaixo chama, pelo backend, a procedure
                <strong>PKG_RESTART_CORE.PRC_EXPORTAR_CURRICULOS_JSON</strong>,
                que monta um array JSON com todos os currículos e grava na tabela
                <strong>EXPORT_JSON_CURRICULO</strong>.
            </p>

            <!-- Botão de exportação -->
            <form th:action="@{/procedures/curriculos/export}" method="post" class="mb-3">
                <button type="submit" class="btn btn-outline-primary w-100">
                    Exportar currículos para JSON (Oracle)
                </button>
            </form>

            <div th:if="${jsonPayload}" class="mb-3">
                <h6>JSON exportado (última execução):</h6>
                <pre class="bg-light border rounded p-2 small"
                     style="max-height: 300px; overflow: auto;"
                     th:text="${jsonPayload}"></pre>
            </div>

            <hr>

            <p class="mb-2">
                Depois de exportar, você pode importar esse mesmo JSON diretamente
                para o banco <strong>MongoDB (NoSQL)</strong> usando o botão abaixo.
            </p>

            <!-- Botão de importação para MongoDB -->
            <form th:action="@{/procedures/curriculos/import-mongo}" method="post">
                <button type="submit" class="btn btn-outline-success w-100">
                    Importar último JSON para o MongoDB
                </button>
            </form>

        </div>
    </div>

</div>

</body>
</html>
